# Методика расчета Программы долгосрочных сбережений (ПДС)

Данный документ описывает алгоритм расчета эффекта от участия в Программе долгосрочных сбережений (ПДС), реализованный в системе.

## 1. Основные параметры и допущения

### 1.1. Лимиты и сроки
*   **Срок софинансирования:** 10 лет с года первого взноса.
*   **Максимальная сумма софинансирования:** 36 000 руб. в год.
*   **Валюта:** Рубли (RUB).
*   **Периодичность начисления софинансирования:** 1 раз в год (в августе года, следующего за годом взносов).

### 1.2. Категории софинансирования
Размер софинансирования зависит от среднемесячного дохода клиента:

| Категория | Доход (руб/мес) | Формула софинансирования | Макс. взнос для 36к |
| :--- | :--- | :--- | :--- |
| **1-я** | до 80 000 | 1 руб. г-ва на 1 руб. клиента (1:1) | 36 000 руб. |
| **2-я** | 80 000 - 150 000 | 1 руб. г-ва на 2 руб. клиента (1:2) | 72 000 руб. |
| **3-я** | от 150 000 | 1 руб. г-ва на 4 руб. клиента (1:4) | 144 000 руб. |

## 2. Алгоритм расчета

### 2.1. Исходные данные
*   `Client Income` (среднемесячный доход).
*   `Portfolio Yield` (ожидаемая доходность портфеля, % годовых).
*   `Inflation` (инфляция, % годовых) — используется для индексации или дисконтирования целей, но **не** влияет на номиналы взносов ПДС в данном расчете (взносы считаются в номинале).
*   `PDS Share` (доля ПДС в портфеле, %).

### 2.2. Пошаговая симуляция (ежемесячно)
Расчет выполняется итеративно по месяцам от `Start Date` до конца срока цели.

#### На каждом шаге (месяце):
1.  **Начисление доходности:**
    $$Capital_{end} = Capital_{start} \times (1 + Yield_{monthly})$$
    
2.  **Взнос клиента:**
    Если месяц входит в период пополнений:
    $$Capital_{end} += MonthlyContribution$$
    Суммируется `YearlyContribution` для текущего года.

3.  **Выплата софинансирования (в Августе):**
    В августе каждого года (начиная со второго года участия) проверяется взнос за **прошлый** год.
    
    *Рассчитываем доступный лимит:*
    $$Limit = 36\,000 - UsedCofinancing_{prevYear}$$
    *(Если у клиента несколько целей, лимит 36к дилится между ними)*

    *Рассчитываем полагающуюся сумму:*
    $$BaseAmount = \min(YearlyContribution_{prevYear} \times Coeff, Limit)$$
    
    где $Coeff$ зависит от дохода (1, 0.5 или 0.25).

    Если $BaseAmount > 0$:
    $$Capital_{end} += BaseAmount$$

### 2.3. Итеративный подбор взноса
Система решает обратную задачу: "Какой ежемесячный взнос нужен, чтобы накопить `TargetAmount`?".

1.  **Проход 1 (Оценка):** Считаем капитал при взносе = `InitialRecommendation` (без учета ПДС). Определяем, сколько софинансирования получим.
2.  **Корректировка:** Вычитаем полученное софинансирование (будущую стоимость) из необходимой суммы.
3.  **Проход 2 (Финишинг):** Пересчитываем необходимый взнос клиента с учетом того, что часть капитала покроет государство.

## 3. Пример расчета

| Параметр | Значение |
| :--- | :--- |
| Доход клиента | 100 000 руб (Категория 2, коэф. 0.5) |
| Взнос в ПДС | 6 000 руб/мес (= 72 000 руб/год) |
| Расчет софинансирования | 72 000 * 0.5 = 36 000 руб. |
| Лимит | 36 000 руб. |
| **Итог от г-ва** | **36 000 руб.** в год (выплата в августе след. года) |

## 4. Особенности реализации
*   Если взнос клиента превышает необходимый для получения 36к, "лишняя" часть просто инвестируется под процент портфеля.

## 4. Практический кейс: Цель "Пенсия"

Рассмотрим детальный пример расчета для проверки методики.

### 4.1. Вводные данные
*   **Клиент:** Женщина, 45 лет.
*   **Доход:** 120 000 руб/мес.
    *   *Категория софинансирования:* 2-я (доход 80к - 150к).
    *   *Коэффициент:* 1:2 (1 рубль государства на 2 рубля клиента).
    *   *Макс. выплата:* 36 000 руб/год.
*   **Цель:** Пенсия через 15 лет (в 60 лет).
*   **Взнос в ПДС:** 6 000 руб/мес (фиксировано для примера).
    *   *В год:* 72 000 руб.
*   **Доходность портфеля:** 10% годовых (фиксировано).
*   **Старт программы:** Январь 2025 года.

### 4.2. Расчет софинансирования
*   Взнос клиента за год: `72 000 руб.`
*   Расчетная выплата (1:2): `72 000 / 2 = 36 000 руб.`
*   Лимит: `36 000 руб.`
*   **Итог:** Государство начислит **36 000 руб.**

### 4.3. Таймлайн (упрощенно)

#### Год 1 (2025) - Взносы
*   Клиент вносит по 6 000 руб/мес.
*   Итого внесено: 72 000 руб.
*   Софинансирование: **0 руб.** (выплачивается в следующем году).
*   Капитал на конец года (с %): ~75 000 руб. (примерно).

#### Год 2 (2026) - Первая выплата
*   Клиент продолжает вносить 6 000 руб/мес.
*   **Август 2026:** Государство начисляет +36 000 руб. за 2025 год.
*   Эти 36 000 руб. сразу начинают работать под 10% годовых.

#### ... Годы 3-10 ...
*   Процесс повторяется. Каждый август приходит +36 000 руб. за прошлый год.

#### Год 11 (2035) - Последняя выплата
*   Взносы клиента продолжаются (если он хочет).
*   **Август 2035:** Приходит **последняя** выплата 36 000 руб. за 2034 год (10-й год участия).
*   За 2035 год и далее софинансирования уже **не будет**.

#### Годы 12-15
*   Работает только сложный процент на уже накопленный капитал + новые взносы клиента (без добавок государства).

## 5. Особенности реализации в системе
1.  **Лимит 10 лет:** Отсчитывается строго календарно от года первого взноса.
2.  **Date-Specific Logic:** Если старт цели в декабре 2024, то 2024 считается "первым годом", даже если был всего один взнос.
